From a34ed5ea12cc1a1b1039c2fe5eafb1e9be2ab03c Mon Sep 17 00:00:00 2001
From: Dmitry Perchanov <dmitry.perchanov@intel.com>
Date: Mon, 27 Jun 2022 15:51:03 +0300
Subject: [PATCH] D4XX bump to version 1.0.1.12

---
 drivers/media/i2c/d4xx.c | 12 ++++++++----
 1 file changed, 8 insertions(+), 4 deletions(-)

diff --git a/drivers/media/i2c/d4xx.c b/drivers/media/i2c/d4xx.c
index a84fc05..6109b7d 100644
--- a/drivers/media/i2c/d4xx.c
+++ b/drivers/media/i2c/d4xx.c
@@ -3448,7 +3448,7 @@ static int ds5_chrdev_remove(struct ds5 *state)
 }
 
 /* SYSFS attributes */
-
+#ifdef CONFIG_SYSFS
 static ssize_t ds5_fw_ver_show(struct device *dev,
 		struct device_attribute *attr, char *buf)
 {
@@ -3502,7 +3502,7 @@ static ssize_t ds5_read_reg_show(struct device *dev,
 		return -EINVAL;
 	ds5_read(state, ds5_rw_attr->reg, &rbuf);
 
-	n = sprintf(buf, "register:0x%4x, value:0x%02x\n", ds5_rw_attr->reg, rbuf);
+	n = sprintf(buf, "register:0x%04x, value:0x%02x\n", ds5_rw_attr->reg, rbuf);
 
 	return n;
 }
@@ -3569,6 +3569,7 @@ static struct attribute *ds5_attributes[] = {
 static const struct attribute_group ds5_attr_group = {
 	.attrs = ds5_attributes,
 };
+#endif
 
 static int ds5_probe(struct i2c_client *c, const struct i2c_device_id *id)
 {
@@ -3658,9 +3659,10 @@ static int ds5_probe(struct i2c_client *c, const struct i2c_device_id *id)
 	}
 */
 	/* Custom sysfs attributes */
+#ifdef CONFIG_SYSFS
 	/* create the sysfs file group */
 	err = sysfs_create_group(&state->client->dev.kobj, &ds5_attr_group);
-
+#endif
 	return 0;
 
 e_chardev:
@@ -3679,7 +3681,9 @@ static int ds5_remove(struct i2c_client *c)
 	if (state->vcc)
 		regulator_disable(state->vcc);
 //	gpio_free(state->pwdn_gpio);
+#ifdef CONFIG_SYSFS
 	sysfs_remove_group(&c->dev.kobj, &ds5_attr_group);
+#endif
 	ds5_chrdev_remove(state);
 	if (state->dfu_dev.dfu_state_flag != DS5_DFU_RECOVERY)
 		ds5_mux_remove(state);
@@ -3717,4 +3721,4 @@ MODULE_AUTHOR( "Guennadi Liakhovetski <guennadi.liakhovetski@intel.com>,\n\
 				Shikun Ding <shikun.ding@intel.com>");
 MODULE_AUTHOR("Dmitry Perchanov <dmitry.perchanov@intel.com>");
 MODULE_LICENSE("GPL v2");
-MODULE_VERSION("1.0.1.11");
+MODULE_VERSION("1.0.1.12");
-- 
2.17.1

