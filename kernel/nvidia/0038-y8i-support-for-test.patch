From 664dd6a7a501cae8f6f05999937a11b21ee9ad5c Mon Sep 17 00:00:00 2001
From: "Shikun, Ding" <shikun.ding@intel.com>
Date: Thu, 17 Feb 2022 17:44:10 +0800
Subject: [PATCH] y8i support for test

Signed-off-by: Shikun, Ding <shikun.ding@intel.com>
---
 drivers/media/i2c/d4xx.c                        | 17 ++++++++++++++++-
 .../platform/tegra/camera/vi/vi4_formats.h      |  2 ++
 .../platform/tegra/camera/vi/vi5_formats.h      |  3 +++
 3 files changed, 21 insertions(+), 1 deletion(-)

diff --git a/drivers/media/i2c/d4xx.c b/drivers/media/i2c/d4xx.c
index 12ece6b11..097ee10ca 100644
--- a/drivers/media/i2c/d4xx.c
+++ b/drivers/media/i2c/d4xx.c
@@ -676,6 +676,11 @@ static const struct ds5_format ds5_depth_formats_d43x[] = {
 		.mbus_code = MEDIA_BUS_FMT_Y8_1X8,
 		.n_resolutions = ARRAY_SIZE(d43x_depth_sizes),
 		.resolutions = d43x_depth_sizes,
+	}, {
+		.data_type = 0x32,	/* Y8I */
+		.mbus_code = MEDIA_BUS_FMT_RGB565_1X16,
+		.n_resolutions = ARRAY_SIZE(d43x_depth_sizes),
+		.resolutions = d43x_depth_sizes,
 	}, {
 		.data_type = 0x24,	/* 24-bit Calibration */
 		.mbus_code = MEDIA_BUS_FMT_RGB888_1X24,	/* FIXME */
@@ -692,11 +697,16 @@ static const struct ds5_format ds5_depth_formats_d46x[] = {
 		.n_resolutions = ARRAY_SIZE(d46x_depth_sizes),
 		.resolutions = d46x_depth_sizes,
 	}, {
-		/* First format: default */
 		.data_type = 0x2a,	/* Y8 */
 		.mbus_code = MEDIA_BUS_FMT_Y8_1X8,
 		.n_resolutions = ARRAY_SIZE(d46x_depth_sizes),
 		.resolutions = d46x_depth_sizes,
+	}, {
+		/* First format: default */
+		.data_type = 0x32,	/* Y8I */
+		.mbus_code = MEDIA_BUS_FMT_RGB565_1X16,
+		.n_resolutions = ARRAY_SIZE(d46x_depth_sizes),
+		.resolutions = d46x_depth_sizes,
 	}, {
 		.data_type = 0x24,	/* 24-bit Calibration */
 		.mbus_code = MEDIA_BUS_FMT_RGB888_1X24,	/* FIXME */
@@ -714,6 +724,11 @@ static const struct ds5_format ds5_y_formats_ds5u[] = {
 		.mbus_code = MEDIA_BUS_FMT_Y8_1X8,
 		.n_resolutions = ARRAY_SIZE(y8_sizes),
 		.resolutions = y8_sizes,
+	}, {
+		.data_type = 0x32,	/* Y8I */
+		.mbus_code = MEDIA_BUS_FMT_RGB565_1X16,
+		.n_resolutions = ARRAY_SIZE(y8_sizes),
+		.resolutions = y8_sizes,
 	}, {
 		.data_type = 0x24,	/* 24-bit Calibration */
 		.mbus_code = MEDIA_BUS_FMT_RGB888_1X24,	/* FIXME */
diff --git a/drivers/media/platform/tegra/camera/vi/vi4_formats.h b/drivers/media/platform/tegra/camera/vi/vi4_formats.h
index 6f8b1fac7..b0ccffc62 100644
--- a/drivers/media/platform/tegra/camera/vi/vi4_formats.h
+++ b/drivers/media/platform/tegra/camera/vi/vi4_formats.h
@@ -155,6 +155,8 @@ static const struct tegra_video_format vi4_video_formats[] = {
 	TEGRA_VIDEO_FORMAT(RGB888, 24, RGB888_1X24, 4, 1, T_A8R8G8B8,
 				RGB888, Y12I, "Y12I 24"),
 
+	TEGRA_VIDEO_FORMAT(RGB565, 16, RGB565_1X16, 2, 1, T_R5G6B5,
+				USER_3, Y8I, "Y8I 16"),
 };
 
 #endif
diff --git a/drivers/media/platform/tegra/camera/vi/vi5_formats.h b/drivers/media/platform/tegra/camera/vi/vi5_formats.h
index 7d2169ee0..0722df200 100644
--- a/drivers/media/platform/tegra/camera/vi/vi5_formats.h
+++ b/drivers/media/platform/tegra/camera/vi/vi5_formats.h
@@ -152,6 +152,9 @@ static const struct tegra_video_format vi5_video_formats[] = {
 	// R[7:3]R[3:0] | L[3:0]R[11:8] | L[11:8]L[7:4] | ALIGN[7:0]
 	TEGRA_VIDEO_FORMAT(RGB888, 24, RGB888_1X24, 4, 1, T_A8R8G8B8,
 				RGB888, Y12I, "Y12I 24"),
+
+	TEGRA_VIDEO_FORMAT(RGB565, 16, RGB565_1X16, 2, 1, T_R5G6B5,
+				USER_3, Y8I, "Y8I 16"),
 };
 
 #endif
-- 
2.17.1

